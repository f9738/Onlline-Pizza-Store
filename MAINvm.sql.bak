set serveroutput on;
set verify off;

CREATE OR REPLACE TRIGGER ORDERED
AFTER INSERT ON
ORDERS
BEGIN
	DBMS_OUTPUT.PUT_LINE('ORDER IS BEING PROCESSED');
END;
/



DECLARE

	ORDERTAKINGG NUMBER := 0;
	A INT ;
	
	MENU_IDS VARCHAR(50);
	M1 VARCHAR(10) := '0';
	M2 VARCHAR(10) := '0';
	M3 VARCHAR(10) := '0';
	M4 VARCHAR(10) := '0';
	M5 VARCHAR(10) := '0';
	
	M11 INTEGER;
	M12 INTEGER;
	M13 INTEGER;
	M14 INTEGER;
	M15 INTEGER;
	
	D1 NUMBER;
	D2 NUMBER;
	D3 NUMBER;
	D4 NUMBER;
	D5 NUMBER;
	
	QUANTITIES VARCHAR(50);
	Q1 VARCHAR(10) := '0';
	Q2 VARCHAR(10) := '0';
	Q3 VARCHAR(10) := '0';
	Q4 VARCHAR(10) := '0';
	Q5 VARCHAR(10) := '0';
	
	D11 NUMBER;
	D22 NUMBER;
	D33 NUMBER;
	D44 NUMBER;
	D55 NUMBER;
	
	CN CUSTOMERS.CUSTOMER_NAME%TYPE;
	CA CUSTOMERS.CUSTOMER_ADDRESS%TYPE;
	
	INVALID_ORDER EXCEPTION;
	INVALID_ORDER1 EXCEPTION;
	
	
	N1 NUMBER;
	
	ZZ NUMBER;
	PRICEE NUMBER := 0;
	TOTAL_NUMBER_OF_ORDERS INT;
	
BEGIN
	
	
	
	
	MENU_IDS := '&X1';
	QUANTITIES := '&Y1';
	CN := '&CN';
	CA := '&CA';
	
	--ORDERTAKINGG := ORDERSS(M_IDS, QTITIES, CN, CA);
	
	
	--Q1 := SUBSTR(STRING,1, INSTR(STRING, ',' , 1, 1)-1);
	--D1 := INSTR(STRING,',',1,1);
	
	M1 := SUBSTR(MENU_IDS,1, INSTR(MENU_IDS, ',' , 1, 1)-1);
	D1 := INSTR(MENU_IDS,',',1,1);
	
	--Q2 := SUBSTR(STRING,D1+1, INSTR(STRING, ',' , 1, 1));
	--D2 := INSTR(STRING,',',1,2);
	IF(LENGTH(M1)+1<LENGTH(MENU_IDS)) THEN
		M2 := SUBSTR(MENU_IDS,D1+1, INSTR(MENU_IDS, ',' , 1, 1)-1);
		D2 := INSTR(MENU_IDS,',',1,2);
	ELSE M2 := '0';
	END IF;
	
	IF(LENGTH(M1)+LENGTH(M2)+2<LENGTH(MENU_IDS)) THEN
		M3 := SUBSTR(MENU_IDS,D2+1, INSTR(MENU_IDS, ',' , 1, 1)-1);
		D3 := INSTR(MENU_IDS,',',1,3);
	ELSE M3 := '0';
	END IF;
	
	IF(LENGTH(M1)+LENGTH(M2)+LENGTH(M3)+3<LENGTH(MENU_IDS)) THEN
		M4 := SUBSTR(MENU_IDS,D3+1, INSTR(MENU_IDS, ',' , 1, 1)-1);
		D4 := INSTR(MENU_IDS,',',1,4);
	ELSE M4 := '0';
	END IF;
	
	IF(LENGTH(M1)+LENGTH(M2)+LENGTH(M3)+LENGTH(M4)+4<LENGTH(MENU_IDS)) THEN
		M5 := SUBSTR(MENU_IDS,D4+1, INSTR(MENU_IDS, ',' , 1, 1)-1);
		D5 := INSTR(MENU_IDS,',',1,5);
	ELSE M5 := '0';
	END IF;
	
	--DBMS_OUTPUT.PUT_LINE(''||M1||'');
	--DBMS_OUTPUT.PUT_LINE(''||M2||'');
	--DBMS_OUTPUT.PUT_LINE(''||M3||'');
	--DBMS_OUTPUT.PUT_LINE(''||M4||'');
	--DBMS_OUTPUT.PUT_LINE(''||M5||'');
	
	
	
	Q1:= SUBSTR(QUANTITIES,1, INSTR(QUANTITIES, ',' , 1, 1)-1);
	D11 := INSTR(QUANTITIES,',',1,1);
	
	
	IF(LENGTH(Q1)+1<LENGTH(QUANTITIES)) THEN
		Q2 := SUBSTR(QUANTITIES,D11+1, INSTR(QUANTITIES, ',' , 1, 1)-1);
		D22 := INSTR(QUANTITIES,',',1,2);
	ELSE Q2 := '0';
	END IF;
	
	IF(LENGTH(Q1)+LENGTH(Q2)+2<LENGTH(QUANTITIES)) THEN
		Q3 := SUBSTR(QUANTITIES,D22+1, INSTR(QUANTITIES, ',' , 1, 1)-1);
		D33 := INSTR(QUANTITIES,',',1,3);
	ELSE Q3 := '0';
	END IF;
	
	IF(LENGTH(Q1)+LENGTH(Q2)+LENGTH(Q3)+3<LENGTH(QUANTITIES)) THEN
		Q4 := SUBSTR(QUANTITIES,D33+1, INSTR(QUANTITIES, ',' , 1, 1)-1);
		D44 := INSTR(QUANTITIES,',',1,4);
	ELSE Q4 := '0';
	END IF;
	
	
	IF(LENGTH(Q1)+LENGTH(Q2)+LENGTH(Q3)+LENGTH(Q4)+4<LENGTH(QUANTITIES)) THEN
		Q5 := SUBSTR(QUANTITIES,D44+1, INSTR(QUANTITIES, ',' , 1, 1)-1);
		D55 := INSTR(QUANTITIES,',',1,5);
	ELSE Q5 := '0';
	END IF;
	
	
	--DBMS_OUTPUT.PUT_LINE(''||Q1||'');
	--DBMS_OUTPUT.PUT_LINE(''||Q2||'');
	--DBMS_OUTPUT.PUT_LINE(''||Q3||'');
	--DBMS_OUTPUT.PUT_LINE(''||Q4||'');
	--DBMS_OUTPUT.PUT_LINE(''||Q5||'');
	
	--DBMS_OUTPUT.PUT_LINE(''||Q1*2||'');
	
	
	
	
	--ORDERTAKINGG := ORDERTAKING(A,T,M1,Q1,CN,CA
	FOR Z IN (SELECT COUNT(O_ID) AS COUNTT FROM ORDERS) LOOP
			N1 := Z.COUNTT;
			IF(N1>100000) THEN
				DELETE FROM ORDERS WHERE O_ID>=100000;
				N1 := 100000;
			ELSE N1 := Z.COUNTT;
			END IF;
	END LOOP;
	
	
	
	IF(M1!='0' AND M2!='0' AND M3!='0' AND M4!='0' AND M5!='0') THEN
		--SELECT PRICE FROM MENU WHERE M_ID = M1;
		M11 := CAST(M1 AS INTEGER);
		M12 := CAST(M2 AS INTEGER);
		M13 := CAST(M3 AS INTEGER);
		M14 := CAST(M4 AS INTEGER);
		M15 := CAST(M5 AS INTEGER);
		IF(((M1>=1 AND M1<=24) OR (M1>=37 AND M1<=40)) AND ((M2>=1 AND M2<=24) OR (M2>=37 AND M2<=40)) AND ((M3>=1 AND M3<=24) OR (M3>=37 AND M3<=40)) AND ((M4>=1 AND M4<=24) OR (M4>=37 AND M4<=40)) AND ((M5>=1 AND M5<=24) OR (M5=>37 AND M5<=40))) THEN
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M1,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M1)||'', Q1, Q1*(SELECT M_PRICE FROM MENU WHERE M_ID = M1) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M2,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M2)||'', Q2, Q2*(SELECT M_PRICE FROM MENU WHERE M_ID = M2) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M3,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M3)||'', Q3, Q3*(SELECT M_PRICE FROM MENU WHERE M_ID = M3) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M4,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M4)||'', Q4, Q4*(SELECT M_PRICE FROM MENU WHERE M_ID = M4) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M5,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M5)||'', Q5, Q5*(SELECT M_PRICE FROM MENU WHERE M_ID = M5) ,''||CN||'',''||CA||'',1); 
		ELSE 
			RAISE INVALID_ORDER1;
		END IF;
		
	ELSIF(M1!='0' AND M2!='0' AND M3!='0' AND M4!='0' AND M5='0') THEN
		M11 := CAST(M1 AS INTEGER);
		M12 := CAST(M2 AS INTEGER);
		M13 := CAST(M3 AS INTEGER);
		M14 := CAST(M4 AS INTEGER);
		M15 := CAST(M5 AS INTEGER);
		IF(((M1>=1 AND M1<=24) OR (M1>=37 AND M1<=40)) AND ((M2>=1 AND M2<=24) OR (M2>=37 AND M2<=40)) AND ((M3>=1 AND M3<=24) OR (M3>=37 AND M3<=40)) AND ((M4>=1 AND M4<=24) OR (M4>=37 AND M4<=40))) THEN			--SELECT PRICE FROM MENU WHERE M_ID = M1;
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M1,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M1)||'', Q1, Q1*(SELECT M_PRICE FROM MENU WHERE M_ID = M1) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M2,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M2)||'', Q2, Q2*(SELECT M_PRICE FROM MENU WHERE M_ID = M2) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M3,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M3)||'', Q3, Q3*(SELECT M_PRICE FROM MENU WHERE M_ID = M3) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M4,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M4)||'', Q4, Q4*(SELECT M_PRICE FROM MENU WHERE M_ID = M4) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M5,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M5)||'', Q5, Q5*(SELECT M_PRICE FROM MENU WHERE M_ID = M5) ,''||CN||'',''||CA||'',1);
		ELSE 
			RAISE INVALID_ORDER1;
		END IF;
		
	ELSIF(M1!='0' AND M2!='0' AND M3!='0' AND M4='0' AND M5='0') THEN
		M11 := CAST(M1 AS INTEGER);
		M12 := CAST(M2 AS INTEGER);
		M13 := CAST(M3 AS INTEGER);
		M14 := CAST(M4 AS INTEGER);
		M15 := CAST(M5 AS INTEGER);
		IF(((M1>=1 AND M1<=24) OR (M1>=37 AND M1<=40)) AND ((M2>=1 AND M2<=24) OR (M2>=37 AND M2<=40)) AND ((M3>=1 AND M3<=24) OR (M3>=37 AND M3<=40))) THEN
				
			--SELECT PRICE FROM MENU WHERE M_ID = M1;
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M1,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M1)||'', Q1, Q1*(SELECT M_PRICE FROM MENU WHERE M_ID = M1) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M2,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M2)||'', Q2, Q2*(SELECT M_PRICE FROM MENU WHERE M_ID = M2) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M3,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M3)||'', Q3, Q3*(SELECT M_PRICE FROM MENU WHERE M_ID = M3) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M4,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M4)||'', Q4, Q4*(SELECT M_PRICE FROM MENU WHERE M_ID = M4) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M5,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M5)||'', Q5, Q5*(SELECT M_PRICE FROM MENU WHERE M_ID = M5) ,''||CN||'',''||CA||'',1);
		ELSE 
			RAISE INVALID_ORDER1;
		END IF;
		
	ELSIF(M1!='0' AND M2!='0' AND M3='0' AND M4='0' AND M5='0') THEN
		M11 := CAST(M1 AS INTEGER);
		M12 := CAST(M2 AS INTEGER);
		M13 := CAST(M3 AS INTEGER);
		M14 := CAST(M4 AS INTEGER);
		M15 := CAST(M5 AS INTEGER);
		IF(((M1>=1 AND M1<=24) OR (M1>=37 AND M1<=40)) AND ((M2>=1 AND M2<=24) OR (M2>=37 AND M2<=40))) THEN
			
			--SELECT PRICE FROM MENU WHERE M_ID = M1;
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M1,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M1)||'', Q1, Q1*(SELECT M_PRICE FROM MENU WHERE M_ID = M1) ,''||CN||'',''||CA||'',1);    
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M2,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M2)||'', Q2, Q2*(SELECT M_PRICE FROM MENU WHERE M_ID = M2) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M3,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M3)||'', Q3, Q3*(SELECT M_PRICE FROM MENU WHERE M_ID = M3) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M4,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M4)||'', Q4, Q4*(SELECT M_PRICE FROM MENU WHERE M_ID = M4) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M5,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M5)||'', Q5, Q5*(SELECT M_PRICE FROM MENU WHERE M_ID = M5) ,''||CN||'',''||CA||'',1);
		ELSE 
			RAISE INVALID_ORDER1;
		END IF;
	
	ELSIF(M1!='0' AND M2='0' AND M3='0' AND M4='0' AND M5='0') THEN
		M11 := CAST(M1 AS INTEGER);
		M12 := CAST(M2 AS INTEGER);
		M13 := CAST(M3 AS INTEGER);
		M14 := CAST(M4 AS INTEGER);
		M15 := CAST(M5 AS INTEGER);
		IF(((M1>=1 AND M1<=24) OR (M1>=37 AND M1<=40))) THEN
			--SELECT PRICE FROM MENU WHERE M_ID = M1;
			INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+100001, M1,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M1)||'', Q1, Q1*(SELECT M_PRICE FROM MENU WHERE M_ID = M1) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M2,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M2)||'', Q2, Q2*(SELECT M_PRICE FROM MENU WHERE M_ID = M2) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M3,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M3)||'', Q3, Q3*(SELECT M_PRICE FROM MENU WHERE M_ID = M3) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M4,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M4)||'', Q4, Q4*(SELECT M_PRICE FROM MENU WHERE M_ID = M4) ,''||CN||'',''||CA||'',1);    
			--INSERT INTO ORDERS (O_ID, m_ID,  O_ITEMS, QUANTITY, PRICE, CUSTOMER_NAME, CUSTOMER_ADDRESS, L_ID) VALUES (N1+1, M5,  ''||(SELECT M_NAME_SIZE FROM MENU WHERE M_ID = M5)||'', Q5, Q5*(SELECT M_PRICE FROM MENU WHERE M_ID = M5) ,''||CN||'',''||CA||'',1);
		ELSE 
			RAISE INVALID_ORDER1;
		END IF;
		
	ELSIF(M1='0') THEN
		RAISE INVALID_ORDER;
	
	
	
	
	END IF;
	
	FOR Z IN (SELECT * FROM ORDERS WHERE O_ID = N1+100001) LOOP
		
			ZZ := Z.PRICE;
			PRICEE := PRICEE + ZZ;
			
			
		
	END LOOP;
		DBMS_OUTPUT.PUT_LINE('TOTAL PRICE : '||PRICEE);

	--END IF;
EXCEPTION

	WHEN INVALID_ORDER THEN
		DBMS_OUTPUT.PUT_LINE('YOU MAY BE MISSING A COMMA SOMEWHERE');
		DBMS_OUTPUT.PUT_LINE('PLEASE DO RECHECK');
		
	WHEN INVALID_ORDER1 THEN
		DBMS_OUTPUT.PUT_LINE('ITEM DOES NOT EXIST IN THIS AREA');
		DBMS_OUTPUT.PUT_LINE('PLEASE INPUT AN AVAILABLE ITEM');
	
	
	
	
	
	
	
	

END;
/
